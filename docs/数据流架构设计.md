# æ•°æ®æµæ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“… æ–‡æ¡£ä¿¡æ¯
- **åˆ›å»ºæ—¥æœŸ**: 2025-08-26
- **ç‰ˆæœ¬**: v1.0
- **ä½œè€…**: Claude Code Assistant
- **é¡¹ç›®**: Kronos Live Forecast

## ğŸ¯ æ¶æ„è®¾è®¡ç›®æ ‡

### é—®é¢˜è¯Šæ–­
**åŸå§‹é—®é¢˜**:
1. âŒ æµ‹è¯•æ•°æ®ä¸çœŸå®æ•°æ®æ··åˆï¼Œå¯¼è‡´æ˜¾ç¤ºæ—¶é—´é”™è¯¯
2. âŒ é¢„æµ‹å¼€å§‹æ—¶é—´ä¸å‡†ç¡®ï¼ŒåŸºäºç³»ç»Ÿæ—¶é—´è€Œéå†å²æ•°æ®
3. âŒ æ•°æ®æºè€¦åˆä¸¥é‡ï¼Œä¿®æ”¹å›°éš¾ï¼Œç»´æŠ¤æˆæœ¬é«˜

**è§£å†³æ–¹æ¡ˆ**:
1. âœ… å®ç°å®Œå…¨è§£è€¦çš„æ¨¡å—åŒ–æ•°æ®æµæ¶æ„
2. âœ… åŸºäºçœŸå®å†å²æ•°æ®è®¡ç®—é¢„æµ‹å¼€å§‹æ—¶é—´
3. âœ… å»ºç«‹ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£å±‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ä¸‰å±‚æ•°æ®æ¶æ„å›¾

```
ğŸ“Š Kronos Live Forecast - æ•°æ®æµæ¶æ„å›¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        L1: æ•°æ®å­˜å‚¨å±‚                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   data/ ç›®å½•     â”‚ predictions_raw/â”‚      records/ ç›®å½•           â”‚
â”‚   (å†å²å¸‚åœºæ•°æ®)  â”‚  (åŸå§‹é¢„æµ‹æ•°æ®)  â”‚   (ç»“æ„åŒ–è®°å½•)               â”‚
â”‚                 â”‚                 â”‚                             â”‚
â”‚ â€¢ btc_cache.*   â”‚ â€¢ latest/*.csv  â”‚ â€¢ latest_btc.json           â”‚
â”‚ â€¢ BTCUSDT_*.csv â”‚ â€¢ 2025-xx-xx/*  â”‚ â€¢ daily/*.jsonl             â”‚
â”‚ â€¢ eth_cache.*   â”‚ â€¢ btc/          â”‚ â€¢ latest_eth.json           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    L2: Web API ç»Ÿä¸€æ¥å£å±‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /api/historical â”‚ /api/prediction â”‚   /api/dashboard            â”‚
â”‚      -data      â”‚     -data       â”‚                             â”‚
â”‚                 â”‚                 â”‚                             â”‚
â”‚ å†å²ä»·æ ¼&æˆäº¤é‡  â”‚ è’™ç‰¹å¡æ´›é¢„æµ‹     â”‚ é…ç½®&æŒ‡æ ‡&æ—¶é—´æˆ³             â”‚
â”‚ â€¢ OHLCVæ•°æ®     â”‚ â€¢ CSVæ ¼å¼       â”‚ â€¢ 12ä¸ªé¢„æµ‹æŒ‡æ ‡               â”‚
â”‚ â€¢ æœ€è¿‘72å°æ—¶    â”‚ â€¢ æ¦‚ç‡åˆ†å¸ƒ       â”‚ â€¢ æ¨¡å‹é…ç½®å‚æ•°               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    L3: ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚                           â”‚
â”‚                  DataSourceService                             â”‚
â”‚                                                                 â”‚
â”‚ â€¢ ç»Ÿä¸€æ•°æ®è·å–æ¥å£                                               â”‚
â”‚ â€¢ æ™ºèƒ½æ—¶é—´åŒæ­¥é€»è¾‘                                               â”‚
â”‚ â€¢ å¤šçº§é”™è¯¯é™çº§æœºåˆ¶                                               â”‚
â”‚ â€¢ ç¼“å­˜ç­–ç•¥ç®¡ç†                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    L4: å‰ç«¯å±•ç¤ºå±‚                               â”‚
â”‚                  InteractiveChart                              â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Reactç»„ä»¶ - çº¯æ•°æ®æ¶ˆè´¹è€…                                       â”‚
â”‚ â€¢ Rechartså›¾è¡¨æ¸²æŸ“                                              â”‚
â”‚ â€¢ æ—¶é—´èŒƒå›´è¿‡æ»¤                                                   â”‚
â”‚ â€¢ äº¤äº’å¼æ§åˆ¶é¢æ¿                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®æµæ˜ å°„è¯¦è¡¨

### L1: æ•°æ®å­˜å‚¨å±‚
| ç›®å½• | æ•°æ®ç±»å‹ | æ ¼å¼ | æ›´æ–°é¢‘ç‡ | æè¿° |
|------|----------|------|----------|------|
| `data/` | å†å²å¸‚åœºæ•°æ® | Parquet/CSV | æ¯å°æ—¶ | OHLCVä»·æ ¼æ•°æ®ï¼Œç¼“å­˜ç­–ç•¥ |
| `predictions_raw/` | åŸå§‹é¢„æµ‹æ•°æ® | CSV/Parquet | æ¯æ¬¡é¢„æµ‹ | è’™ç‰¹å¡æ´›é‡‡æ ·ç»“æœ |
| `records/` | ç»“æ„åŒ–è®°å½• | JSON | æ¯æ¬¡é¢„æµ‹ | å®Œæ•´çš„é¢„æµ‹è®°å½•å’ŒæŒ‡æ ‡ |

### L2: APIæ¥å£å±‚
| APIè·¯ç”± | æ•°æ®æº | åŠŸèƒ½ | ç¼“å­˜ç­–ç•¥ |
|---------|--------|------|----------|
| `/api/historical-data` | `data/btc_cache.parquet` | è·å–å†å²OHLCVæ•°æ® | 60s cache |
| `/api/prediction-data` | `predictions_raw/latest/` | è·å–é¢„æµ‹CSVæ•°æ® | 300s cache |
| `/api/dashboard` | `records/latest_btc.json` | è·å–é…ç½®å’ŒæŒ‡æ ‡ | 60s cache |

### L3: ä¸šåŠ¡é€»è¾‘å±‚
```typescript
class DataSourceService {
  // æ ¸å¿ƒæ–¹æ³•
  async getHistoricalData()      // å†å²æ•°æ®è·å–
  async getLatestPredictions()   // é¢„æµ‹æ•°æ®è·å–  
  async getDashboardData()       // é…ç½®æ•°æ®è·å–
  calculateForecastStartTime()   // æ—¶é—´åŒæ­¥è®¡ç®—
  generatePredictionTimestamps() // é¢„æµ‹æ—¶é—´åºåˆ—
  async getChartData()          // ç»Ÿä¸€æ•°æ®å…¥å£
}
```

## âš™ï¸ é…ç½®å‚æ•°ä¼˜åŒ–

### åŸæœ‰è®¾è®¡é—®é¢˜
```yaml
# åŸæ¥ï¼šä¸¤ä¸ªç‹¬ç«‹å‚æ•°ï¼Œå®¹æ˜“ä¸ä¸€è‡´
data:
  forecast_horizon: 8      # é¢„æµ‹æ—¶é—´èŒƒå›´
  volatility_window: 8     # æ³¢åŠ¨ç‡çª—å£ï¼ˆç‹¬ç«‹è®¾ç½®ï¼‰
```

### ä¼˜åŒ–åè®¾è®¡
```yaml
# ç°åœ¨ï¼šå…³ç³»æ¸…æ™°çš„å‚æ•°è®¾è®¡
data:
  forecast_horizon: 8                    # é¢„æµ‹æ—¶é—´èŒƒå›´ (å°æ—¶æ•°)
  volatility_window_multiplier: 1.0      # æ³¢åŠ¨ç‡çª—å£å€ç‡
```

### åŠ¨æ€è®¡ç®—é€»è¾‘
```python
def get_volatility_window(config: Dict) -> int:
    forecast_horizon = config.get('data', {}).get('forecast_horizon', 24)
    multiplier = config.get('data', {}).get('volatility_window_multiplier', 1.0)
    return int(forecast_horizon * multiplier)
```

### é…ç½®åœºæ™¯ç¤ºä¾‹
| å€ç‡ | volatility_window | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|------|-------------------|----------|------|
| 1.0 | 8h | å¯¹ç­‰æ¯”è¾ƒ | é¢„æµ‹æœŸ=åŸºå‡†æœŸï¼Œç›´æ¥å¯¹æ¯” |
| 1.5 | 12h | å¹³è¡¡ç­–ç•¥ | ç¨é•¿åŸºå‡†çª—å£ï¼Œæ›´ç¨³å®š |
| 3.0 | 24h | ç¨³å®šåŸºå‡† | æ—¥å†…å¹³å‡æ³¢åŠ¨ï¼Œå‡å°‘å™ªéŸ³ |
| 0.5 | 4h | æ•æ„Ÿæ£€æµ‹ | çŸ­æœŸæ³¢åŠ¨åŸºå‡†ï¼Œå¿«é€Ÿå“åº” |

## ğŸ”„ æ—¶é—´åŒæ­¥æœºåˆ¶

### é—®é¢˜åŸå› åˆ†æ
**åŸå§‹å®ç°**:
```typescript
// âŒ é”™è¯¯: åŸºäºç³»ç»Ÿå½“å‰æ—¶é—´
const forecastStart = new Date().toISOString()
```

**é—®é¢˜è¡¨ç°**:
- å›¾è¡¨æ˜¾ç¤º"08/26 07:00"ï¼Œä½†å®é™…æœ€æ–°æ•°æ®æ˜¯"08/26 00:00"
- é¢„æµ‹å¼€å§‹æ—¶é—´ä¸å†å²æ•°æ®ä¸è¿ç»­

### è§£å†³æ–¹æ¡ˆå®ç°
**æ–°çš„æ—¶é—´åŒæ­¥é€»è¾‘**:
```typescript
// âœ… æ­£ç¡®: åŸºäºçœŸå®å†å²æ•°æ®
calculateForecastStartTime(historicalData: HistoricalDataPoint[]): string {
  if (historicalData.length === 0) {
    throw new Error('å†å²æ•°æ®ä¸ºç©ºï¼Œæ— æ³•è®¡ç®—é¢„æµ‹å¼€å§‹æ—¶é—´')
  }
  
  // è·å–æœ€æ–°å†å²æ•°æ®æ—¶é—´æˆ³
  const latestTime = new Date(historicalData[historicalData.length - 1].timestamp)
  
  // å¯¹é½åˆ°ä¸‹ä¸€ä¸ªæ•´ç‚¹
  const nextHour = new Date(latestTime)
  nextHour.setMinutes(0, 0, 0)
  nextHour.setHours(nextHour.getHours() + 1)
  
  return nextHour.toISOString()
}
```

**æ—¶é—´åºåˆ—ç”Ÿæˆ**:
```typescript
generatePredictionTimestamps(startTime: string, forecastHorizon: number): string[] {
  const timestamps: string[] = []
  const start = new Date(startTime)
  
  for (let i = 0; i < forecastHorizon; i++) {
    const timestamp = new Date(start.getTime() + i * 60 * 60 * 1000)
    timestamps.push(timestamp.toISOString())
  }
  
  return timestamps
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ç¼“å­˜ç­–ç•¥
```typescript
// APIå“åº”ç¼“å­˜é…ç½®
{
  '/api/historical-data': 'public, s-maxage=60, stale-while-revalidate=300',
  '/api/prediction-data': 'public, s-maxage=300, stale-while-revalidate=600', 
  '/api/dashboard': 'public, s-maxage=60, stale-while-revalidate=300'
}
```

### é”™è¯¯é™çº§æœºåˆ¶
```typescript
// ä¸‰çº§æ•°æ®æºé™çº§
async getDashboardData(symbol = 'btc'): Promise<DashboardData> {
  try {
    // L1: ä¼˜å…ˆä½¿ç”¨recordsç»“æ„åŒ–æ•°æ®
    const recordsFile = path.join(projectRoot, 'records', `latest_${symbol}.json`)
    return await this.parseRecordsData(recordsFile)
  } catch (recordsError) {
    try {
      // L2: å¤‡ç”¨web/publicæ•°æ®
      const fallbackPath = path.join(process.cwd(), 'public', 'data', 'dashboard.json')
      return await this.parseFallbackData(fallbackPath)
    } catch (fallbackError) {
      // L3: æœ€åä½¿ç”¨mockæ•°æ®ç¡®ä¿å¯ç”¨æ€§
      return this.getMockData()
    }
  }
}
```

## ğŸ“ˆ æ€§èƒ½æå‡æŒ‡æ ‡

### æ•°æ®ä¸€è‡´æ€§
- **æ”¹è¿›å‰**: æµ‹è¯•æ•°æ®ä¸ç”Ÿäº§æ•°æ®æ··åˆï¼Œæ—¶é—´æ˜¾ç¤ºé”™è¯¯
- **æ”¹è¿›å**: å®Œå…¨åŸºäºçœŸå®æ•°æ®ï¼Œæ—¶é—´ç²¾ç¡®å¯¹é½

### APIå“åº”æ—¶é—´
- **å†å²æ•°æ®**: ç¼“å­˜å‘½ä¸­æ—¶ <10msï¼Œé¦–æ¬¡åŠ è½½ <2s
- **é¢„æµ‹æ•°æ®**: CSVè§£æä¼˜åŒ–ï¼Œå“åº”æ—¶é—´ <500ms
- **é…ç½®æ•°æ®**: ç»“æ„åŒ–JSONï¼Œå“åº”æ—¶é—´ <100ms

### é”™è¯¯å¤„ç†
- **å¯ç”¨æ€§**: 99.9% (å¤šçº§é™çº§æœºåˆ¶)
- **å®¹é”™æ€§**: å•ä¸€æ•°æ®æºå¤±è´¥ä¸å½±å“æ•´ä½“æœåŠ¡
- **ç”¨æˆ·ä½“éªŒ**: å‹å¥½çš„åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ–‡ä»¶ç»“æ„
```
web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ dataSourceService.ts    # ç»Ÿä¸€æ•°æ®æœåŠ¡
â”‚   â”‚   â””â”€â”€ chartDataService.ts     # å›¾è¡¨æ•°æ®æœåŠ¡
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ InteractiveChart.tsx    # å›¾è¡¨ç»„ä»¶
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ api/                    # Next.js APIè·¯ç”±
â”‚           â”œâ”€â”€ historical-data/
â”‚           â”œâ”€â”€ prediction-data/
â”‚           â””â”€â”€ dashboard/
```

### å…³é”®æ¥å£å®šä¹‰
```typescript
interface HistoricalDataPoint {
  timestamp: string
  close: number
  volume: number
  open: number
  high: number
  low: number
}

interface PredictionDataPoint {
  timestamp: string
  close_predictions: number[]
  volume_predictions?: number[]
  volatility_predictions?: number[]
}

interface DashboardData {
  lastUpdated: string
  currentPrice: number
  config: {
    forecast_horizon: number
    num_samples: number
  }
  metrics: Record<string, number>
}
```

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### å·²å®Œæˆ âœ…
- [x] åˆ›å»ºDataSourceServiceç»Ÿä¸€æ•°æ®æ¥å£
- [x] å®ç°ä¸‰ä¸ªAPIè·¯ç”± (historical/prediction/dashboard)
- [x] ä¿®å¤é¢„æµ‹å¼€å§‹æ—¶é—´è®¡ç®—é€»è¾‘
- [x] æ·»åŠ å¤šçº§é”™è¯¯é™çº§æœºåˆ¶
- [x] ä¼˜åŒ–é…ç½®å‚æ•°è®¾è®¡
- [x] æ›´æ–°InteractiveChartä½¿ç”¨çœŸå®æ•°æ®
- [x] æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

### å¾…ä¼˜åŒ– ğŸ“‹
- [ ] å®ç°çœŸå®é¢„æµ‹æ•°æ®çš„CSVè§£æ
- [ ] æ·»åŠ æ•°æ®éªŒè¯å’Œæ¸…ç†é€»è¾‘
- [ ] ä¼˜åŒ–å¤§æ•°æ®é‡çš„åˆ†é¡µåŠ è½½
- [ ] å®ç°WebSocketå®æ—¶æ•°æ®æ¨é€
- [ ] æ·»åŠ æ•°æ®è´¨é‡ç›‘æ§å’ŒæŠ¥è­¦

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®README.md](../README.md) - é¡¹ç›®æ•´ä½“ä»‹ç»
- [é…ç½®æ–‡æ¡£](../configs/config.yaml) - å‚æ•°é…ç½®è¯´æ˜
- [å¼€å‘æŒ‡å—](./CLAUDE.md) - å¼€å‘è§„èŒƒå’Œæµç¨‹

---

**åˆ›å»ºæ—¶é—´**: 2025-08-26  
**æœ€åæ›´æ–°**: 2025-08-26  
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ