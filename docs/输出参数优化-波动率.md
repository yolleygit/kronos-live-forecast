# ğŸš€ **æ³¢åŠ¨ç‡æ”¾å¤§æŒ‡æ ‡å®Œæ•´ä½“ç³»**

å‚è€ƒä¸Šæ¶¨æ¦‚ç‡æŒ‡æ ‡çš„å®Œå–„æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯**æ³¢åŠ¨ç‡æ”¾å¤§æŒ‡æ ‡çš„å…¨é¢ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

## ğŸ“Š **å®Œæ•´æŒ‡æ ‡ä½“ç³»**

### **1. vol_amp_prob_24h** - 24å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡
- **å«ä¹‰**ï¼šé¢„æµ‹æ³¢åŠ¨ç‡ç›¸æ¯”è¿‡å»24å°æ—¶å†å²æ”¾å¤§çš„æ¦‚ç‡
- **ä½œç”¨**ï¼šè¯„ä¼°çŸ­æœŸæ³¢åŠ¨é£é™©ï¼Œåˆçº¦äº¤æ˜“é£æ§çš„åŸºç¡€æŒ‡æ ‡
- **å‚è€ƒå€¼**ï¼š>70%ä¸ºé«˜æ³¢åŠ¨é¢„è­¦ï¼Œ<30%ä¸ºä½æ³¢åŠ¨ç¯å¢ƒ

### **2. vol_amp_prob_48h** - 48å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡  
- **å«ä¹‰**ï¼šé¢„æµ‹æ³¢åŠ¨ç‡ç›¸æ¯”è¿‡å»48å°æ—¶å†å²æ”¾å¤§çš„æ¦‚ç‡
- **ä½œç”¨**ï¼šæä¾›æ›´ç¨³å®šçš„ä¸­æœŸæ³¢åŠ¨åŸºå‡†ï¼Œé¿å…å•æ—¥å¼‚å¸¸å½±å“
- **å‚è€ƒå€¼**ï¼š>65%ä¸ºæ˜¾è‘—æ”¾å¤§ï¼Œ<25%ä¸ºæ³¢åŠ¨æ”¶æ•›

### **3. avg_amplification_factor** - å¹³å‡æ”¾å¤§å€æ•°
- **å«ä¹‰**ï¼šé¢„æµ‹æ³¢åŠ¨ç‡ç›¸å¯¹å†å²åŸºå‡†çš„å¹³å‡æ”¾å¤§å€æ•°
- **ä½œç”¨**ï¼šé‡åŒ–æ³¢åŠ¨æ”¾å¤§ç¨‹åº¦ï¼Œè¯„ä¼°é£é™©æš´éœ²çº§åˆ«
- **å‚è€ƒå€¼**ï¼š>2.5å€ä¸ºæç«¯æ”¾å¤§ï¼Œ1.2-1.8å€ä¸ºæ¸©å’Œæ”¾å¤§

### **4. extreme_vol_prob** - æç«¯æ³¢åŠ¨æ¦‚ç‡
- **å«ä¹‰**ï¼šé¢„æµ‹å‡ºç°2å€ä»¥ä¸Šæ³¢åŠ¨æ”¾å¤§çš„æ¦‚ç‡
- **ä½œç”¨**ï¼šè¯†åˆ«**é»‘å¤©é¹…äº‹ä»¶**å’Œå¸‚åœºæç«¯æƒ…å†µ[1][3]
- **å‚è€ƒå€¼**ï¼š>25%ä¸ºæé«˜é£é™©ï¼Œ<8%ä¸ºç›¸å¯¹å®‰å…¨

### **5. vol_persistence_score** - æ³¢åŠ¨æŒç»­æ€§è¯„åˆ†
- **å«ä¹‰**ï¼šé¢„æµ‹24å°æ—¶å†…æ³¢åŠ¨ç‡çš„æŒç»­ç¨‹åº¦å’Œè‡ªç›¸å…³æ€§
- **ä½œç”¨**ï¼šåˆ¤æ–­æ³¢åŠ¨æ˜¯ç¬æ—¶å†²å‡»è¿˜æ˜¯æŒç»­è¶‹åŠ¿
- **å‚è€ƒå€¼**ï¼š>0.7ä¸ºå¼ºæŒç»­æ€§ï¼Œ<0.3ä¸ºå¼±æŒç»­æ€§

### **6. overall_vol_risk_score** - ç»¼åˆæ³¢åŠ¨é£é™©è¯„åˆ†
- **å«ä¹‰**ï¼šç»¼åˆæ‰€æœ‰æ³¢åŠ¨æŒ‡æ ‡çš„0-100åˆ†é£é™©è¯„åˆ†
- **ä½œç”¨**ï¼šæä¾›ä¸€ç«™å¼æ³¢åŠ¨é£é™©è¯„ä¼°ï¼Œç®€åŒ–å†³ç­–æµç¨‹
- **å‚è€ƒå€¼**ï¼š>80åˆ†ä¸ºæé«˜é£é™©ï¼Œ<40åˆ†ä¸ºä½é£é™©ç¯å¢ƒ

## ğŸ¯ **æŒ‡æ ‡ç»„åˆå®æˆ˜åº”ç”¨**

### **å¼ºåŠ¿æ³¢åŠ¨é¢„è­¦ç»„åˆ**
```python
volatility_indicators = {
    'vol_amp_prob_24h': 0.78,           # 78% - é«˜æ¦‚ç‡æ”¾å¤§
    'vol_amp_prob_48h': 0.65,           # 65% - ä¸­æœŸä¹Ÿç¡®è®¤æ”¾å¤§
    'avg_amplification_factor': 2.4,     # 2.4å€ - æ˜¾è‘—æ”¾å¤§
    'extreme_vol_prob': 0.28,            # 28% - æç«¯é£é™©è¾ƒé«˜
    'vol_persistence_score': 0.72,       # 72% - é«˜æŒç»­æ€§
    'overall_vol_risk_score': 82         # 82åˆ† - æé«˜é£é™©
}
# å†³ç­–ï¼šç«‹å³é™æ æ†ï¼Œå‡å°ä»“ä½ï¼Œè®¾ç´§æ­¢æŸ
```

### **æ¸©å’Œæ³¢åŠ¨ç¯å¢ƒç»„åˆ**
```python
volatility_indicators = {
    'vol_amp_prob_24h': 0.45,           # 45% - æ¸©å’Œæ”¾å¤§æ¦‚ç‡
    'vol_amp_prob_48h': 0.38,           # 38% - ä¸­æœŸåŸºå‡†ä¸‹æ”¾å¤§æ¦‚ç‡ä¸€èˆ¬
    'avg_amplification_factor': 1.3,     # 1.3å€ - è½»å¾®æ”¾å¤§
    'extreme_vol_prob': 0.12,            # 12% - æç«¯é£é™©å¯æ§
    'vol_persistence_score': 0.55,       # 55% - ä¸­ç­‰æŒç»­æ€§
    'overall_vol_risk_score': 48         # 48åˆ† - ä¸­ç­‰é£é™©
}
# å†³ç­–ï¼šæ ‡å‡†æ“ä½œï¼Œé€‚åº¦æ æ†ï¼Œæ­£å¸¸æ­¢æŸè®¾ç½®
```

### **ä½æ³¢åŠ¨å¥—åˆ©ç¯å¢ƒç»„åˆ**
```python
volatility_indicators = {
    'vol_amp_prob_24h': 0.22,           # 22% - ä½æ”¾å¤§æ¦‚ç‡
    'vol_amp_prob_48h': 0.18,           # 18% - ä¸­æœŸåŸºå‡†ç¡®è®¤ä½æ³¢åŠ¨
    'avg_amplification_factor': 0.8,     # 0.8å€ - æ³¢åŠ¨æ”¶æ•›
    'extreme_vol_prob': 0.03,            # 3% - å‡ ä¹æ— æç«¯é£é™©
    'vol_persistence_score': 0.25,       # 25% - æ³¢åŠ¨ä¸æŒç»­
    'overall_vol_risk_score': 28         # 28åˆ† - ä½é£é™©
}
# å†³ç­–ï¼šå¯å¢åŠ æ æ†ï¼Œé€‚åˆç½‘æ ¼ç­–ç•¥ï¼Œæ”¾å®½æ­¢æŸ
```

## âš¡ **æ ¸å¿ƒä¼˜åŠ¿**

1. **å¤šæ—¶é—´ç»´åº¦**ï¼š24hå’Œ48håŒé‡åŸºå‡†ï¼Œé¿å…å•ä¸€æ—¶é—´çª—å£åå·®[3][6]
2. **é‡åŒ–ç¨‹åº¦**ï¼šä»ç®€å•äºŒå…ƒåˆ°ç²¾ç¡®å€æ•°ï¼Œæä¾›ç²¾å‡†é£é™©é‡åŒ–[1]
3. **æç«¯è¯†åˆ«**ï¼šä¸“é—¨æ•æ‰é»‘å¤©é¹…äº‹ä»¶å’Œå¸‚åœºå¼‚å¸¸æ³¢åŠ¨[4][5]
4. **æŒç»­æ€§åˆ†æ**ï¼šåŒºåˆ†ç¬æ—¶å†²å‡»å’ŒæŒç»­è¶‹åŠ¿ï¼Œä¼˜åŒ–ç­–ç•¥é€‰æ‹©
5. **é£é™©é›†æˆ**ï¼šç»¼åˆè¯„åˆ†ç³»ç»Ÿç®€åŒ–å¤æ‚å†³ç­–æµç¨‹
6. **åŠ å¯†é€‚é…**ï¼šé’ˆå¯¹åŠ å¯†è´§å¸24/7äº¤æ˜“å’Œé«˜æ³¢åŠ¨ç‰¹å¾ä¼˜åŒ–[8][9]

## ğŸ”¢ **æŒ‡æ ‡çš„å…·ä½“è®¡ç®—æ–¹æ³•**

### **åŸºç¡€æ•°æ®ç»“æ„**
```python
# è¾“å…¥æ•°æ®
hist_df = pd.DataFrame({
    'close': [å†å²ä»·æ ¼åºåˆ—],
    'timestamps': [æ—¶é—´åºåˆ—]
})

close_preds_df = pd.DataFrame({
    'sample_1': [24å°æ—¶é¢„æµ‹ä»·æ ¼åºåˆ—],
    'sample_2': [24å°æ—¶é¢„æµ‹ä»·æ ¼åºåˆ—],
    ...
    'sample_30': [24å°æ—¶é¢„æµ‹ä»·æ ¼åºåˆ—]
})
# shape: (24è¡Œ Ã— 30åˆ—)
```

### **1. vol_amp_prob_24h - 24å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡**
```python
def calculate_vol_amp_prob_24h(hist_df, close_preds_df):
    """è®¡ç®—24å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡"""
    last_close = hist_df['close'].iloc[-1]
    
    # è®¡ç®—24å°æ—¶å†å²æ³¢åŠ¨ç‡ï¼ˆåŸºå‡†ï¼‰
    hist_log_returns = np.log(hist_df['close'] / hist_df['close'].shift(1))
    hist_vol_24h = hist_log_returns.iloc[-24:].std() if len(hist_log_returns) >= 24 else hist_log_returns.std()
    
    amplification_count = 0
    
    for col in close_preds_df.columns:
        # æ„å»ºå®Œæ•´ä»·æ ¼åºåˆ—
        full_sequence = pd.concat([
            pd.Series([last_close]), 
            close_preds_df[col]
        ]).reset_index(drop=True)
        
        # è®¡ç®—é¢„æµ‹å¯¹æ•°æ”¶ç›Šç‡å’Œæ³¢åŠ¨ç‡
        pred_log_returns = np.log(full_sequence / full_sequence.shift(1)).dropna()
        predicted_vol = pred_log_returns.std()
        
        # åˆ¤æ–­æ˜¯å¦æ”¾å¤§
        if predicted_vol > hist_vol_24h:
            amplification_count += 1
    
    return amplification_count / len(close_preds_df.columns)

# ç¤ºä¾‹è®¡ç®—
# å†å²24å°æ—¶æ³¢åŠ¨ç‡: 0.025 (2.5%)
# 30ä¸ªé¢„æµ‹ä¸­æœ‰23ä¸ªæ ·æœ¬çš„æ³¢åŠ¨ç‡ > 0.025
# vol_amp_prob_24h = 23/30 = 0.77 (77%)
```

### **2. vol_amp_prob_48h - 48å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡**
```python
def calculate_vol_amp_prob_48h(hist_df, close_preds_df):
    """è®¡ç®—48å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡"""
    last_close = hist_df['close'].iloc[-1]
    
    # è®¡ç®—48å°æ—¶å†å²æ³¢åŠ¨ç‡ï¼ˆæ›´ç¨³å®šçš„åŸºå‡†ï¼‰
    hist_log_returns = np.log(hist_df['close'] / hist_df['close'].shift(1))
    hist_vol_48h = hist_log_returns.iloc[-48:].std() if len(hist_log_returns) >= 48 else hist_log_returns.iloc[-24:].std()
    
    amplification_count = 0
    
    for col in close_preds_df.columns:
        full_sequence = pd.concat([pd.Series([last_close]), close_preds_df[col]]).reset_index(drop=True)
        pred_log_returns = np.log(full_sequence / full_sequence.shift(1)).dropna()
        predicted_vol = pred_log_returns.std()
        
        if predicted_vol > hist_vol_48h:
            amplification_count += 1
    
    return amplification_count / len(close_preds_df.columns)

# ç¤ºä¾‹è®¡ç®—  
# å†å²48å°æ—¶æ³¢åŠ¨ç‡: 0.028 (2.8%)
# 30ä¸ªé¢„æµ‹ä¸­æœ‰19ä¸ªæ ·æœ¬çš„æ³¢åŠ¨ç‡ > 0.028
# vol_amp_prob_48h = 19/30 = 0.63 (63%)
```

### **3. avg_amplification_factor - å¹³å‡æ”¾å¤§å€æ•°**
```python
def calculate_avg_amplification_factor(hist_df, close_preds_df):
    """è®¡ç®—å¹³å‡æ”¾å¤§å€æ•°"""
    last_close = hist_df['close'].iloc[-1]
    
    # åŸºå‡†æ³¢åŠ¨ç‡ï¼ˆ24å°æ—¶ï¼‰
    hist_log_returns = np.log(hist_df['close'] / hist_df['close'].shift(1))
    base_vol = hist_log_returns.iloc[-24:].std() if len(hist_log_returns) >= 24 else hist_log_returns.std()
    
    amplification_factors = []
    
    for col in close_preds_df.columns:
        full_sequence = pd.concat([pd.Series([last_close]), close_preds_df[col]]).reset_index(drop=True)
        pred_log_returns = np.log(full_sequence / full_sequence.shift(1)).dropna()
        predicted_vol = pred_log_returns.std()
        
        # è®¡ç®—æ”¾å¤§å€æ•°ï¼Œé¿å…é™¤é›¶
        amplification_factor = predicted_vol / (base_vol + 1e-8)
        amplification_factors.append(amplification_factor)
    
    return np.mean(amplification_factors)

# ç¤ºä¾‹è®¡ç®—
# åŸºå‡†æ³¢åŠ¨ç‡: 0.025
# 30ä¸ªé¢„æµ‹æ³¢åŠ¨ç‡: [0.035, 0.022, 0.048, 0.031, ...]
# æ”¾å¤§å€æ•°: [1.4, 0.88, 1.92, 1.24, ...]
# avg_amplification_factor = mean([1.4, 0.88, 1.92, 1.24, ...]) = 1.6
```

### **4. extreme_vol_prob - æç«¯æ³¢åŠ¨æ¦‚ç‡**
```python
def calculate_extreme_vol_prob(hist_df, close_preds_df, extreme_threshold=2.0):
    """è®¡ç®—æç«¯æ³¢åŠ¨æ¦‚ç‡ï¼ˆé»˜è®¤2å€é˜ˆå€¼ï¼‰"""
    last_close = hist_df['close'].iloc[-1]
    
    hist_log_returns = np.log(hist_df['close'] / hist_df['close'].shift(1))
    base_vol = hist_log_returns.iloc[-24:].std() if len(hist_log_returns) >= 24 else hist_log_returns.std()
    
    extreme_count = 0
    
    for col in close_preds_df.columns:
        full_sequence = pd.concat([pd.Series([last_close]), close_preds_df[col]]).reset_index(drop=True)
        pred_log_returns = np.log(full_sequence / full_sequence.shift(1)).dropna()
        predicted_vol = pred_log_returns.std()
        
        # åˆ¤æ–­æ˜¯å¦ä¸ºæç«¯æ³¢åŠ¨ï¼ˆæ”¾å¤§2å€ä»¥ä¸Šï¼‰
        amplification_factor = predicted_vol / (base_vol + 1e-8)
        if amplification_factor > extreme_threshold:
            extreme_count += 1
    
    return extreme_count / len(close_preds_df.columns)

# ç¤ºä¾‹è®¡ç®—
# åŸºå‡†æ³¢åŠ¨ç‡: 0.025
# æç«¯é˜ˆå€¼: 2.0å€ = 0.050
# 30ä¸ªé¢„æµ‹ä¸­æœ‰7ä¸ªæ ·æœ¬æ³¢åŠ¨ç‡ > 0.050
# extreme_vol_prob = 7/30 = 0.23 (23%)
```

### **5. vol_persistence_score - æ³¢åŠ¨æŒç»­æ€§è¯„åˆ†**
```python
def calculate_vol_persistence_score(close_preds_df, last_close, window_size=6):
    """è®¡ç®—æ³¢åŠ¨æŒç»­æ€§è¯„åˆ†"""
    persistence_scores = []
    
    for col in close_preds_df.columns:
        path = close_preds_df[col].values
        full_path = np.concatenate([[last_close], path])
        
        # è®¡ç®—æ»šåŠ¨æ³¢åŠ¨ç‡ï¼ˆ6å°æ—¶çª—å£ï¼‰
        rolling_vols = []
        for i in range(window_size, len(full_path)):
            window_data = full_path[i-window_size:i+1]
            window_returns = np.diff(np.log(window_data))
            rolling_vol = np.std(window_returns)
            rolling_vols.append(rolling_vol)
        
        # è®¡ç®—æ³¢åŠ¨ç‡çš„è‡ªç›¸å…³ç³»æ•°ï¼ˆæŒç»­æ€§æŒ‡æ ‡ï¼‰
        if len(rolling_vols) > 1:
            # è®¡ç®—æ»å1æœŸçš„è‡ªç›¸å…³
            correlation_matrix = np.corrcoef(rolling_vols[:-1], rolling_vols[1:])
            persistence = correlation_matrix[0, 1]
            
            # å¤„ç†NaNå€¼
            if not np.isnan(persistence):
                persistence_scores.append(max(0, persistence))  # ç¡®ä¿éè´Ÿ
            else:
                persistence_scores.append(0)
        else:
            persistence_scores.append(0)
    
    return np.mean(persistence_scores)

# ç¤ºä¾‹è®¡ç®—
# å¯¹æ¯ä¸ªé¢„æµ‹è·¯å¾„è®¡ç®—6å°æ—¶æ»šåŠ¨æ³¢åŠ¨ç‡åºåˆ—
# è®¡ç®—ç›¸é‚»æ—¶æ®µæ³¢åŠ¨ç‡çš„ç›¸å…³æ€§
# 30ä¸ªæ ·æœ¬çš„æŒç»­æ€§è¯„åˆ†: [0.65, 0.43, 0.78, 0.52, ...]
# vol_persistence_score = mean([0.65, 0.43, 0.78, 0.52, ...]) = 0.59
```

### **6. overall_vol_risk_score - ç»¼åˆæ³¢åŠ¨é£é™©è¯„åˆ†**
```python
def calculate_overall_vol_risk_score(vol_metrics):
    """è®¡ç®—ç»¼åˆæ³¢åŠ¨é£é™©è¯„åˆ†ï¼ˆ0-100ï¼‰"""
    
    # å„é¡¹æŒ‡æ ‡æƒé‡
    weights = {
        'vol_amp_prob_24h': 0.25,        # 25% - çŸ­æœŸæ”¾å¤§æ¦‚ç‡
        'avg_amplification_factor': 0.20, # 20% - æ”¾å¤§ç¨‹åº¦
        'extreme_vol_prob': 0.20,         # 20% - æç«¯é£é™©
        'vol_persistence_score': 0.15,    # 15% - æŒç»­æ€§é£é™©
        'vol_amp_prob_48h': 0.20         # 20% - ä¸­æœŸç¡®è®¤
    }
    
    # æ ‡å‡†åŒ–å„é¡¹æŒ‡æ ‡åˆ°0-100åŒºé—´
    normalized_scores = {}
    
    # 24å°æ—¶æ”¾å¤§æ¦‚ç‡æ ‡å‡†åŒ–
    normalized_scores['vol_amp_prob_24h'] = min(100, vol_metrics['vol_amp_prob_24h'] * 100)
    
    # 48å°æ—¶æ”¾å¤§æ¦‚ç‡æ ‡å‡†åŒ–  
    normalized_scores['vol_amp_prob_48h'] = min(100, vol_metrics['vol_amp_prob_48h'] * 100)
    
    # å¹³å‡æ”¾å¤§å€æ•°æ ‡å‡†åŒ–ï¼ˆä»¥2å€ä¸ºæ»¡åˆ†ï¼‰
    normalized_scores['avg_amplification_factor'] = min(100, (vol_metrics['avg_amplification_factor'] / 2.0) * 100)
    
    # æç«¯æ³¢åŠ¨æ¦‚ç‡æ ‡å‡†åŒ–ï¼ˆä»¥30%ä¸ºæ»¡åˆ†ï¼‰
    normalized_scores['extreme_vol_prob'] = min(100, (vol_metrics['extreme_vol_prob'] / 0.3) * 100)
    
    # æŒç»­æ€§è¯„åˆ†æ ‡å‡†åŒ–
    normalized_scores['vol_persistence_score'] = vol_metrics['vol_persistence_score'] * 100
    
    # åŠ æƒè®¡ç®—ç»¼åˆè¯„åˆ†
    overall_score = sum(
        normalized_scores[key] * weights[key] 
        for key in weights.keys()
    )
    
    return round(overall_score, 0)

# ç¤ºä¾‹è®¡ç®—
# vol_metrics = {
#     'vol_amp_prob_24h': 0.78,
#     'vol_amp_prob_48h': 0.65, 
#     'avg_amplification_factor': 1.8,
#     'extreme_vol_prob': 0.23,
#     'vol_persistence_score': 0.59
# }
# 
# normalized_scores = {
#     'vol_amp_prob_24h': 78,
#     'vol_amp_prob_48h': 65,
#     'avg_amplification_factor': 90,  # (1.8/2.0)*100
#     'extreme_vol_prob': 77,          # (0.23/0.3)*100  
#     'vol_persistence_score': 59
# }
# 
# overall_score = 78*0.25 + 65*0.20 + 90*0.20 + 77*0.20 + 59*0.15 = 74
```

## ğŸ”§ **å®Œæ•´è®¡ç®—å‡½æ•°**
```python
def calculate_enhanced_volatility_metrics(hist_df, close_preds_df):
    """è®¡ç®—å®Œæ•´çš„6é¡¹æ³¢åŠ¨ç‡æŒ‡æ ‡"""
    
    last_close = hist_df['close'].iloc[-1]
    
    # è®¡ç®—å„é¡¹åŸºç¡€æŒ‡æ ‡
    results = {}
    
    # 1. 24å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡
    results['vol_amp_prob_24h'] = calculate_vol_amp_prob_24h(hist_df, close_preds_df)
    
    # 2. 48å°æ—¶æ³¢åŠ¨æ”¾å¤§æ¦‚ç‡
    results['vol_amp_prob_48h'] = calculate_vol_amp_prob_48h(hist_df, close_preds_df)
    
    # 3. å¹³å‡æ”¾å¤§å€æ•°
    results['avg_amplification_factor'] = calculate_avg_amplification_factor(hist_df, close_preds_df)
    
    # 4. æç«¯æ³¢åŠ¨æ¦‚ç‡
    results['extreme_vol_prob'] = calculate_extreme_vol_prob(hist_df, close_preds_df)
    
    # 5. æ³¢åŠ¨æŒç»­æ€§è¯„åˆ†
    results['vol_persistence_score'] = calculate_vol_persistence_score(close_preds_df, last_close)
    
    # 6. ç»¼åˆæ³¢åŠ¨é£é™©è¯„åˆ†
    results['overall_vol_risk_score'] = calculate_overall_vol_risk_score(results)
    
    return results

# ä½¿ç”¨ç¤ºä¾‹
volatility_metrics = calculate_enhanced_volatility_metrics(hist_df, close_preds_df)
print(f"Vol Amp 24h: {volatility_metrics['vol_amp_prob_24h']:.1%}")
print(f"Vol Amp 48h: {volatility_metrics['vol_amp_prob_48h']:.1%}")
print(f"Avg Factor: {volatility_metrics['avg_amplification_factor']:.1f}x")
print(f"Extreme Prob: {volatility_metrics['extreme_vol_prob']:.1%}")
print(f"Persistence: {volatility_metrics['vol_persistence_score']:.1%}")
print(f"Overall Risk: {volatility_metrics['overall_vol_risk_score']:.0f}/100")
```

## ğŸ¯ **å…³é”®ä¼˜åŒ–äº®ç‚¹**

1. **ä»äºŒå…ƒåˆ°å¤šå…ƒ**ï¼šå°†ç®€å•çš„"æ˜¯å¦æ”¾å¤§"å‡çº§ä¸º6ç»´åº¦é£é™©ç”»åƒ
2. **æ—¶é—´åŸºå‡†ä¼˜åŒ–**ï¼š24h+48håŒåŸºå‡†é¿å…å•ä¸€çª—å£åå·®
3. **é‡åŒ–ç²¾ç¡®åº¦**ï¼šç²¾ç¡®åˆ°å€æ•°å’Œç™¾åˆ†æ¯”çš„é£é™©é‡åŒ–
4. **æç«¯äº‹ä»¶æ•æ‰**ï¼šä¸“é—¨è¯†åˆ«2å€ä»¥ä¸Šçš„å¼‚å¸¸æ³¢åŠ¨[3][4]
5. **æŒç»­æ€§åˆ†æ**ï¼šåŒºåˆ†ç¬æ—¶å†²å‡»å’ŒæŒç»­è¶‹åŠ¿ï¼Œä¼˜åŒ–ç­–ç•¥é€‰æ‹©
6. **å†³ç­–ç®€åŒ–**ï¼šç»¼åˆè¯„åˆ†å°†å¤æ‚æŒ‡æ ‡ç®€åŒ–ä¸º0-100åˆ†ç›´è§‚è¯„ä»·

è¿™å¥—ä¼˜åŒ–åçš„æ³¢åŠ¨ç‡æŒ‡æ ‡ä½“ç³»ä¸ºåŠ å¯†è´§å¸äº¤æ˜“æä¾›äº†**ä¸“ä¸šçº§çš„é£é™©ç®¡ç†å·¥å…·**ï¼Œæ—¢ä¿æŒäº†ç»Ÿè®¡ä¸¥è°¨æ€§ï¼Œåˆå…·æœ‰å¼ºå®æˆ˜æŒ‡å¯¼ä»·å€¼ï¼
